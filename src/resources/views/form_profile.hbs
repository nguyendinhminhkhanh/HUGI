<body>
    <div id="wrapper">

        <div class="gray-bg">

            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>Thông tin cá nhân</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        <li class="active">
                            <strong>Thông tin cá nhân</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">
                </div>
            </div>
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-7">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title" style="display: flex;justify-content: space-between">
                                <form method="GET" action="/manager">
                                    <button class="btn">Quay lại</button>
                                </form>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <div class="row">
                                    <div class="col-sm-6 b-r" style="padding-bottom: 40px">
                                        <h3 class="m-t-none m-b">Thông tin tài khoản </h3>
                                        <form role="form" action="/manager/personnel/update/{{existingUser._id}}"
                                            method="POST">
                                            <div class="form-group">
                                                <label>Avatar: </label>
                                                {{#if (eq existingUser.avatar "")}}
                                                <img src="/image/Sample_User_Icon.png" width="50" height="50"
                                                    alt="Mô tả ảnh">
                                                {{else}}
                                                <img src="{{existingUser.avatar}}" width="50" height="50"
                                                    alt="Mô tả ảnh">
                                                {{/if}}
                                                <button class="btn btn-info" data-toggle="modal" type="button"
                                                    data-target="#change-image">Thay ảnh</button>
                                            </div>
                                            <div class="form-group"><label>Họ và tên</label> <input type="text"
                                                    name="name" class="form-control" value="{{existingUser.name}}">
                                            </div>
                                            <div class="form-group"><label>Email</label> <input type="email"
                                                    name="email" class="form-control" value="{{existingUser.email}}">
                                            </div>
                                            <div class="form-group"><label>Số điện thoại</label> <input type="phone"
                                                    name="phone" class="form-control" value="{{existingUser.phone}}">
                                            </div>
                                            <div class="form-group"><label>Ngày sinh</label> <input type="date"
                                                    name="dob" class="form-control" value="{{existingUser.dob}}"></div>
                                            {{!-- <div class="form-group"><label>Chức vụ</label>
                                                <select id="role" name="role">
                                                    <option value="{{existingUser.role}}">{{existingUser.role}}</option>
                                                    <option value="user">User</option>
                                                    <option value="CEO">CEO</option>
                                                    <option value="manager">Manager</option>
                                                </select>
                                            </div> --}}
                                            <div class="form-group"><label>Password</label>
                                                <div class="btn btn-danger">Đặt lại mật khẩu</div> {{!-- xây dựng chức
                                                năng đặt lại mật khẩu --}}
                                                {{!-- <input type="password" name="password" class="form-control"
                                                    value="{{personnelID.password}}"> --}}
                                            </div>
                                            <div class="b-5">
                                                <button class="btn btn-sm btn-warning pull-right m-t-n-xs"
                                                    style="margin-left: 10px;" type="submit"><strong>Cập nhật thông
                                                        tin</strong></button>
                                            </div>
                                            <div class="b-5">
                                                <a class="btn btn-sm btn-info pull-right m-t-n-xs"
                                                    href="/"><strong>Hủy</strong></a>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-sm-6">

                                        <div class="ibox">
                                            <div class="ibox-content">
                                                <h2>Lịch sử sửa thông tin</h2>
                                                {{!-- <table class="table table-stripped small m-t-md">
                                                    <tbody>
                                                        <tr>
                                                            <td class="no-borders">
                                                                <i class="fa fa-circle text-navy"
                                                                    style="color: {{CEO.color}}"></i>
                                                            </td>
                                                            <td class="no-borders">
                                                                CEO
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <i class="fa fa-circle text-navy"
                                                                    style="color: #56DFCF;"></i>
                                                            </td>
                                                            <td>
                                                                Manager
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <i class="fa fa-circle text-navy"
                                                                    style="color: #ADEED9;"></i>
                                                            </td>
                                                            <td>
                                                                Admin
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table> --}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>(*) Mọi thay đổi sẽ được cập nhật ở lần đăng nhập tiếp theo</div>
                            </div>
                        </div>
                    </div>
                    <div id="change-image" class="modal fade" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <form class="modal-body" method="POST" action="/profile/editAvatar"
                                    enctype="multipart/form-data">
                                    <h3 class="m-t-none m-b">Hãy chọn file ảnh
                                    </h3>
                                    <!-- Thêm input chọn file -->
                                    <input type="file" id="avatarUpload" name="image" accept="image/*"
                                        class="form-control m-b">
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                                        <button type="submit" class="btn btn-primary" id="saveImage">Thay ảnh</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="footer">
                        {{!-- <div class="pull-right">
                            10GB of <strong>250GB</strong> Free.
                        </div> --}}
                        <div>
                            <strong>Copyright</strong> Company &copy; 2025
                            tiếp theo
                        </div>
                    </div>

                </div>
            </div>
            <!-- iCheck -->
            <script src="js/plugins/iCheck/icheck.min.js"></script>
            <script>
                $(document).ready(function () {
                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green',
                    });
                });
            </script>
            <script>
                $(document).ready(function () {
                    $('#saveImage').click(function () {
                        const fileInput = $('#avatarUpload')[0];
                        if (fileInput.files.length === 0) {
                            alert('Vui lòng chọn ảnh!');
                            return;
                        }

                        const formData = new FormData();
                        formData.append('avatar', fileInput.files[0]);

                        // Gửi ảnh lên server (thay URL bằng API của bạn)
                        $.ajax({
                            url: '/manager/personnel/upload-avatar/{{personnelID._id}}',
                            type: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (response) {
                                toastr.success('Cập nhật ảnh thành công!');
                                $('#change-image').modal('hide');
                                // Cập nhật ảnh hiển thị ngay lập tức
                                $('img[src="/image/image.jpg"]').attr('src', response.newAvatarUrl + '?t=' + Date.now());
                            },
                            error: function (error) {
                                toastr.error('Lỗi khi tải lên ảnh!');
                            }
                        });
                    });
                });
            </script>


</body>